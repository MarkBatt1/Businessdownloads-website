<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Grant Finder - BusinessDownloads.co.uk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 2rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
        }

        .progress-bar {
            margin-bottom: 2rem;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-label {
            color: #94a3b8;
        }

        .progress-label.active {
            color: #1e3a8a;
            font-weight: bold;
        }

        .progress-track {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e3a8a, #3b82f6);
            transition: width 0.3s;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #1e3a8a;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #334155;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label input {
            margin-right: 0.5rem;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            flex: 2;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            flex: 1;
            background: white;
            color: #1e3a8a;
            border: 2px solid #1e3a8a;
        }

        .btn-secondary:hover {
            background: #f0f9ff;
        }

        .btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #1e3a8a;
            border-radius: 50%;
            margin: 0 auto 1rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-header {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .results-header h2 {
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .results-header p {
            color: #64748b;
        }

        .results-header button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: #f1f5f9;
            color: #1e3a8a;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .local-council-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #f59e0b;
            margin-bottom: 1.5rem;
        }

        .local-council-card h3 {
            color: #92400e;
            margin-bottom: 0.5rem;
        }

        .local-council-card p {
            color: #78350f;
            margin-bottom: 1rem;
        }

        .grant-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #10b981;
            margin-bottom: 1.5rem;
        }

        .grant-card.local {
            border-left-color: #f59e0b;
        }

        .grant-card.chamber {
            border-left-color: #8b5cf6;
        }

        .grant-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .grant-header h3 {
            color: #1e3a8a;
            margin-bottom: 0.25rem;
        }

        .grant-provider {
            color: #64748b;
            font-size: 0.9rem;
        }

        .grant-type {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .grant-type.grant {
            background: #dcfce7;
            color: #166534;
        }

        .grant-type.loan {
            background: #dbeafe;
            color: #1e3a8a;
        }

        .grant-type.local {
            background: #fef3c7;
            color: #92400e;
        }

        .grant-type.chamber {
            background: #ede9fe;
            color: #5b21b6;
        }

        .grant-description {
            color: #334155;
            margin-bottom: 1rem;
        }

        .grant-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .grant-detail-item {
            font-size: 0.85rem;
            color: #64748b;
        }

        .grant-detail-value {
            font-weight: 600;
            color: #1e3a8a;
            margin-top: 0.25rem;
        }

        .grant-eligibility {
            margin-bottom: 1rem;
        }

        .grant-eligibility-title {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .grant-eligibility ul {
            margin-left: 1.5rem;
            color: #334155;
        }

        .grant-eligibility li {
            margin-bottom: 0.25rem;
        }

        .grant-apply {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        .grant-apply:hover {
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .grant-details {
                grid-template-columns: 1fr;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Business Grant Finder</h1>
            <p>Discover grants and funding opportunities for your business</p>
        </div>

        <div id="progressBar" class="progress-bar">
            <div class="progress-labels">
                <span id="label1" class="progress-label active">Step 1: Basic Info</span>
                <span id="label2" class="progress-label">Step 2: Details</span>
            </div>
            <div class="progress-track">
                <div id="progressFill" class="progress-fill" style="width: 50%;"></div>
            </div>
        </div>

        <div id="step1" class="card">
            <h2>üìç Tell us about your business</h2>
            
            <div class="form-group">
                <label for="postcode">Postcode</label>
                <input type="text" id="postcode" placeholder="e.g. SW1A 1AA" maxlength="8">
                <p style="font-size: 0.85rem; color: #64748b; margin-top: 0.25rem;">We'll find grants available in your area</p>
            </div>

            <div class="form-group">
                <label for="sector">Business Sector</label>
                <select id="sector">
                    <option value="">Select your sector</option>
                    <option value="Retail">Retail</option>
                    <option value="Hospitality">Hospitality & Catering</option>
                    <option value="Construction">Construction & Trades</option>
                    <option value="Professional">Professional Services</option>
                    <option value="Creative">Creative & Media</option>
                    <option value="Technology">Technology & IT</option>
                    <option value="Manufacturing">Manufacturing</option>
                    <option value="Healthcare">Healthcare & Social Care</option>
                    <option value="Education">Education & Training</option>
                    <option value="Agriculture">Agriculture & Farming</option>
                    <option value="Transport">Transportation & Logistics</option>
                    <option value="Beauty">Beauty & Wellness</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="yearsInBusiness">How long have you been in business? (Years)</label>
                <input type="number" id="yearsInBusiness" min="0" max="100" placeholder="0">
                <p style="font-size: 0.85rem; color: #64748b; margin-top: 0.25rem;">Enter 0 if less than 1 year</p>
            </div>

            <button id="continueBtn" class="btn btn-primary" disabled>Continue to Step 2</button>
        </div>

        <div id="step2" class="card hidden">
            <h2>üìã Additional Details</h2>

            <div class="form-group">
                <label for="businessSize">Business Size</label>
                <select id="businessSize">
                    <option value="">Select business size</option>
                    <option value="Sole Trader">Sole Trader</option>
                    <option value="2-5">2-5 employees</option>
                    <option value="6-10">6-10 employees</option>
                    <option value="11-50">11-50 employees</option>
                    <option value="50+">50+ employees</option>
                </select>
            </div>

            <div class="form-group">
                <label for="turnover">Annual Turnover</label>
                <select id="turnover">
                    <option value="">Select turnover range</option>
                    <option value="Under ¬£50k">Under ¬£50,000</option>
                    <option value="¬£50k-¬£100k">¬£50,000 - ¬£100,000</option>
                    <option value="¬£100k-¬£250k">¬£100,000 - ¬£250,000</option>
                    <option value="¬£250k-¬£500k">¬£250,000 - ¬£500,000</option>
                    <option value="Over ¬£500k">Over ¬£500,000</option>
                </select>
            </div>

            <div class="form-group">
                <label>What are you looking for? (Select all that apply)</label>
                <div class="checkbox-grid" id="purposeCheckboxes"></div>
            </div>

            <div class="button-group">
                <button id="backBtn" class="btn btn-secondary">Back</button>
                <button id="searchBtn" class="btn btn-primary">üîç Find Grants</button>
            </div>
        </div>

        <div id="loading" class="card hidden">
            <div class="loading">
                <div class="spinner"></div>
                <p style="font-size: 1.2rem; color: #64748b;">Searching grant databases...</p>
            </div>
        </div>

        <div id="results" class="hidden">
            <div class="results-header">
                <h2 id="resultsCount"></h2>
                <p id="resultsInfo"></p>
                <button id="newSearchBtn">New Search</button>
            </div>
            <div id="localCouncilCard"></div>
            <div id="grantsContainer"></div>
        </div>
    </div>

    <script>
        // State
        let currentStep = 1;
        const formData = {
            postcode: '',
            sector: '',
            yearsInBusiness: '',
            businessSize: '',
            turnover: '',
            lookingFor: []
        };

        const grantPurposes = [
            'Start-up funding',
            'Equipment & machinery',
            'Training & development',
            'Technology & innovation',
            'Export & international trade',
            'Research & development',
            'Energy efficiency',
            'Expansion & growth',
            'Hiring & recruitment'
        ];

        // Enhanced UK Grants Database
        const UK_GRANTS = [
            // National Grants
            {
                name: 'Start Up Loans',
                provider: 'British Business Bank',
                amount: '¬£500 - ¬£25,000',
                type: 'loan',
                category: 'national',
                description: 'Government-backed loans for new and early-stage businesses across the UK.',
                eligibility: ['Under 2 years in business', 'UK-based business', 'Viable business plan'],
                deadline: 'Rolling applications',
                regions: ['England', 'Scotland', 'Wales', 'Northern Ireland'],
                sectors: ['All'],
                link: 'https://www.startuploans.co.uk/',
                minYears: 0,
                maxYears: 2
            },
            {
                name: 'Innovate UK Smart Grants',
                provider: 'Innovate UK',
                amount: '¬£25,000 - ¬£500,000',
                type: 'grant',
                category: 'national',
                description: 'Funding for game-changing R&D innovation that can significantly impact the UK economy.',
                eligibility: ['UK registered business', 'Innovative project', 'Strong commercial potential'],
                deadline: 'Check website for rounds',
                regions: ['England', 'Scotland', 'Wales', 'Northern Ireland'],
                sectors: ['Technology', 'Manufacturing', 'Creative', 'Healthcare'],
                link: 'https://www.ukri.org/councils/innovate-uk/',
                minYears: 1,
                maxYears: 999
            },

            // Chamber of Commerce
            {
                name: 'British Chambers Grant Scheme',
                provider: 'British Chambers of Commerce',
                amount: 'Up to ¬£5,000',
                type: 'grant',
                category: 'chamber',
                description: 'Support for chamber members for business development, training, and international trade.',
                eligibility: ['BCC member', 'SME', 'Growth focused'],
                deadline: 'Check with local chamber',
                regions: ['England', 'Scotland', 'Wales'],
                sectors: ['All'],
                link: 'https://www.britishchambers.org.uk/',
                minYears: 0,
                maxYears: 999
            },

            // Regional - England
            {
                name: 'Greater London Authority Business Growth Fund',
                provider: 'Greater London Authority',
                amount: 'Up to ¬£25,000',
                type: 'grant',
                category: 'local',
                description: 'Support for London-based SMEs for business expansion, equipment, and job creation.',
                eligibility: ['London-based', 'Job creation', '1+ years trading'],
                deadline: 'Check website',
                regions: ['London'],
                sectors: ['All'],
                link: 'https://www.london.gov.uk/programmes-strategies/business-and-economy',
                minYears: 1,
                maxYears: 999
            },
            {
                name: 'Greater Manchester Business Growth Hub',
                provider: 'Greater Manchester Combined Authority',
                amount: 'Varies',
                type: 'grant',
                category: 'local',
                description: 'Business support and grants for Manchester businesses for growth and innovation.',
                eligibility: ['Greater Manchester based', 'Growth potential'],
                deadline: 'Rolling applications',
                regions: ['Manchester'],
                sectors: ['All'],
                link: 'https://www.businessgrowthhub.com/',
                minYears: 0,
                maxYears: 999
            },
            {
                name: 'Birmingham City Council Business Support',
                provider: 'Birmingham City Council',
                amount: 'Up to ¬£10,000',
                type: 'grant',
                category: 'local',
                description: 'Grants for Birmingham businesses for premises improvements and equipment.',
                eligibility: ['Birmingham-based', 'Job creation or retention'],
                deadline: 'Check website',
                regions: ['Birmingham'],
                sectors: ['All'],
                link: 'https://www.birmingham.gov.uk/business',
                minYears: 0,
                maxYears: 999
            },

            // Scotland
            {
                name: 'Scottish Enterprise Growth Grants',
                provider: 'Scottish Enterprise',
                amount: 'Up to ¬£100,000',
                type: 'grant',
                category: 'regional',
                description: 'Support for ambitious Scottish businesses to scale up, innovate and expand.',
                eligibility: ['Scotland-based', 'Growth potential', 'Job creation'],
                deadline: 'Rolling applications',
                regions: ['Scotland'],
                sectors: ['All'],
                link: 'https://www.scottish-enterprise.com/',
                minYears: 0,
                maxYears: 999
            },

            // Wales
            {
                name: 'Wales Business Fund',
                provider: 'Welsh Government',
                amount: '¬£1,000 - ¬£25,000',
                type: 'grant',
                category: 'regional',
                description: 'Financial support for Welsh businesses for capital investment and business development.',
                eligibility: ['Wales-based', 'SME', 'Viable business case'],
                deadline: 'Rolling applications',
                regions: ['Wales'],
                sectors: ['All'],
                link: 'https://businesswales.gov.wales/',
                minYears: 0,
                maxYears: 999
            },

            // Northern Ireland
            {
                name: 'Invest NI Start-Up Grants',
                provider: 'Invest Northern Ireland',
                amount: 'Up to ¬£25,000',
                type: 'grant',
                category: 'regional',
                description: 'Support for new and early-stage businesses in Northern Ireland.',
                eligibility: ['Northern Ireland-based', 'New business', 'Job creation'],
                deadline: 'Rolling applications',
                regions: ['Northern Ireland'],
                sectors: ['All'],
                link: 'https://www.nibusinessinfo.co.uk/',
                minYears: 0,
                maxYears: 2
            },

            // Sector-Specific
            {
                name: 'Made Smarter Adoption',
                provider: 'Made Smarter',
                amount: 'Up to ¬£25,000 (50% match)',
                type: 'grant',
                category: 'sector',
                description: 'Digital technology adoption for manufacturing SMEs.',
                eligibility: ['Manufacturing', 'North West/NE/Yorkshire/W Midlands', '5-499 employees'],
                deadline: 'Rolling applications',
                regions: ['England'],
                sectors: ['Manufacturing'],
                link: 'https://www.madesmarter.uk/',
                minYears: 1,
                maxYears: 999
            },
            {
                name: 'Rural England Prosperity Fund',
                provider: 'Local Authorities',
                amount: 'Varies by region',
                type: 'grant',
                category: 'sector',
                description: 'Support for rural businesses for infrastructure and business development.',
                eligibility: ['Rural location', 'Job creation', 'Community benefit'],
                deadline: 'Check with local authority',
                regions: ['England'],
                sectors: ['All'],
                link: 'https://www.gov.uk/government/publications/rural-england-prosperity-fund',
                minYears: 0,
                maxYears: 999
            },
            {
                name: 'Energy Efficiency Grants',
                provider: 'Carbon Trust',
                amount: 'Up to ¬£10,000',
                type: 'grant',
                category: 'sector',
                description: 'Support for SMEs investing in energy-saving equipment.',
                eligibility: ['SME under 250 employees', 'Energy-saving project'],
                deadline: 'Rolling applications',
                regions: ['England', 'Scotland', 'Wales'],
                sectors: ['All'],
                link: 'https://www.carbontrust.com/',
                minYears: 0,
                maxYears: 999
            },
            {
                name: 'Export Support Service',
                provider: 'Department for Business and Trade',
                amount: 'Free advice + grants',
                type: 'grant',
                category: 'sector',
                description: 'Support for businesses looking to export or expand internationally.',
                eligibility: ['UK business', 'Export plans', '1+ years trading'],
                deadline: 'Rolling applications',
                regions: ['England', 'Scotland', 'Wales', 'Northern Ireland'],
                sectors: ['All'],
                link: 'https://www.great.gov.uk/export-support/',
                minYears: 1,
                maxYears: 999
            },
            {
                name: 'Help to Grow: Management',
                provider: 'Department for Business and Trade',
                amount: '90% funded (¬£7,500 value)',
                type: 'grant',
                category: 'national',
                description: 'Leadership and management training for SMEs.',
                eligibility: ['5-249 employees', 'Turnover ¬£250k-¬£50m', '1+ years trading'],
                deadline: 'Rolling applications',
                regions: ['England'],
                sectors: ['All'],
                link: 'https://helptogrow.campaign.gov.uk/',
                minYears: 1,
                maxYears: 999
            }
        ];

        // Local Council Lookup
        const LOCAL_COUNCILS = {
            'London': { name: 'Your Local London Borough', url: 'https://www.london.gov.uk/who-we-are/london-boroughs' },
            'Manchester': { name: 'Greater Manchester Combined Authority', url: 'https://www.greatermanchester-ca.gov.uk/' },
            'Birmingham': { name: 'Birmingham City Council', url: 'https://www.birmingham.gov.uk/business' },
            'Leeds': { name: 'Leeds City Council', url: 'https://www.leeds.gov.uk/business' },
            'Liverpool': { name: 'Liverpool City Council', url: 'https://www.liverpool.gov.uk/business' },
            'Scotland': { name: 'Your Local Scottish Council', url: 'https://www.mygov.scot/local-council-services' },
            'Wales': { name: 'Your Local Welsh Council', url: 'https://www.gov.wales/local-authorities' },
            'Northern Ireland': { name: 'Your Local NI Council', url: 'https://www.nidirect.gov.uk/contacts/local-councils-in-northern-ireland' },
            'Default': { name: 'Your Local Council', url: 'https://www.gov.uk/find-local-council' }
        };

        // Initialize
        const purposeContainer = document.getElementById('purposeCheckboxes');
        grantPurposes.forEach(purpose => {
            const label = document.createElement('label');
            label.className = 'checkbox-label';
            label.innerHTML = `
                <input type="checkbox" value="${purpose}">
                <span>${purpose}</span>
            `;
            purposeContainer.appendChild(label);
        });

        // Get region from postcode
        function getRegionFromPostcode(postcode) {
            const area = postcode.toUpperCase().replace(/\s/g, '').substring(0, 2);
            
            // Major cities
            if (['E', 'EC', 'N', 'NW', 'SE', 'SW', 'W', 'WC'].includes(area)) return 'London';
            if (['M'].includes(area)) return 'Manchester';
            if (['B'].includes(area)) return 'Birmingham';
            if (['LS'].includes(area)) return 'Leeds';
            if (['L'].includes(area)) return 'Liverpool';
            
            // Nations
            if (['AB', 'DD', 'DG', 'EH', 'FK', 'G', 'HS', 'IV', 'KA', 'KW', 'KY', 'ML', 'PA', 'PH', 'TD', 'ZE'].includes(area)) return 'Scotland';
            if (['CF', 'CH', 'LD', 'LL', 'NP', 'SA', 'SY'].includes(area)) return 'Wales';
            if (['BT'].includes(area)) return 'Northern Ireland';
            
            return 'England';
        }

        function getLocalCouncil(postcode) {
            const region = getRegionFromPostcode(postcode);
            return LOCAL_COUNCILS[region] || LOCAL_COUNCILS['Default'];
        }

        // Event listeners
        document.getElementById('postcode').addEventListener('input', (e) => {
            formData.postcode = e.target.value.toUpperCase();
            e.target.value = formData.postcode;
            checkStep1();
        });

        document.getElementById('sector').addEventListener('change', (e) => {
            formData.sector = e.target.value;
            checkStep1();
        });

        document.getElementById('yearsInBusiness').addEventListener('input', (e) => {
            formData.yearsInBusiness = e.target.value;
            checkStep1();
        });

        document.getElementById('businessSize').addEventListener('change', (e) => {
            formData.businessSize = e.target.value;
        });

        document.getElementById('turnover').addEventListener('change', (e) => {
            formData.turnover = e.target.value;
        });

        purposeContainer.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                if (e.target.checked) {
                    formData.lookingFor.push(e.target.value);
                } else {
                    formData.lookingFor = formData.lookingFor.filter(item => item !== e.target.value);
                }
            }
        });

        document.getElementById('continueBtn').addEventListener('click', () => showStep(2));
        document.getElementById('backBtn').addEventListener('click', () => showStep(1));
        document.getElementById('searchBtn').addEventListener('click', () => searchGrants());
        document.getElementById('newSearchBtn').addEventListener('click', () => resetSearch());

        function checkStep1() {
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.disabled = !(formData.postcode && formData.sector && formData.yearsInBusiness !== '');
        }

        function showStep(step) {
            currentStep = step;
            document.getElementById('step1').classList.toggle('hidden', step !== 1);
            document.getElementById('step2').classList.toggle('hidden', step !== 2);
            document.getElementById('progressBar').classList.toggle('hidden', step === 3);
            
            document.getElementById('label1').classList.toggle('active', step >= 1);
            document.getElementById('label2').classList.toggle('active', step >= 2);
            document.getElementById('progressFill').style.width = `${(step / 2) * 100}%`;
        }

        async function searchGrants() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            await new Promise(resolve => setTimeout(resolve, 1500));
            const results = filterGrants(formData);
            displayResults(results);
        }

        function filterGrants(data) {
            const region = getRegionFromPostcode(data.postcode);
            const yearsNum = parseInt(data.yearsInBusiness) || 0;
            
            let filtered = UK_GRANTS.filter(grant => {
                if (!grant.regions.some(r => r === region || r === 'All' || (region === 'England' && r === 'England'))) {
                    return false;
                }
                if (yearsNum < grant.minYears || yearsNum > grant.maxYears) return false;
                if (grant.sectors.includes('All')) return true;
                return grant.sectors.some(s => data.sector.toLowerCase().includes(s.toLowerCase()));
            });

            return filtered.sort((a, b) => {
                if (a.category === 'local' && b.category !== 'local') return -1;
                if (a.category !== 'local' && b.category === 'local') return 1;
                if (a.type === 'grant' && b.type === 'loan') return -1;
                if (a.type === 'loan' && b.type === 'grant') return 1;
                return 0;
            });
        }

        function displayResults(grants) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            const region = getRegionFromPostcode(formData.postcode);
            const council = getLocalCouncil(formData.postcode);
            
            document.getElementById('resultsCount').textContent = `Found ${grants.length} grant opportunities`;
            document.getElementById('resultsInfo').textContent = `${formData.sector} ‚Ä¢ ${region} ‚Ä¢ ${formData.yearsInBusiness} years in business`;

            // Local Council Card
            const localCard = document.getElementById('localCouncilCard');
            localCard.innerHTML = `
                <div class="local-council-card">
                    <h3>üèõÔ∏è Check ${council.name} Grants</h3>
                    <p>Many councils offer local business grants that aren't listed in national databases. We recommend checking your local council website for additional funding opportunities.</p>
                    <a href="${council.url}" class="grant-apply" target="_blank" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        Visit Council Website ‚Üí
                    </a>
                    <a href="grant-questionnaire.html" class="grant-apply" style="background: linear-gradient(135deg, #10b981, #059669);">
                        Get Help Finding Local Grants (¬£299)
                    </a>
                </div>
            `;

            // Grants
            const container = document.getElementById('grantsContainer');
            container.innerHTML = '';

            if (grants.length === 0) {
                container.innerHTML = `<div class="grant-card"><h3>No exact matches found</h3><p>Try adjusting your criteria or contact us for personalized recommendations.</p></div>`;
                return;
            }

            grants.forEach(grant => {
                const card = document.createElement('div');
                card.className = `grant-card ${grant.category}`;
                card.innerHTML = `
                    <div class="grant-header">
                        <div>
                            <h3>${grant.name}</h3>
                            <div class="grant-provider">${grant.provider}</div>
                        </div>
                        <span class="grant-type ${grant.type}">${grant.type === 'grant' ? 'Grant' : 'Loan'}</span>
                    </div>
                    <p class="grant-description">${grant.description}</p>
                    <div class="grant-details">
                        <div class="grant-detail-item">
                            <div>Amount</div>
                            <div class="grant-detail-value">${grant.amount}</div>
                        </div>
                        <div class="grant-detail-item">
                            <div>Deadline</div>
                            <div class="grant-detail-value">${grant.deadline}</div>
                        </div>
                        <div class="grant-detail-item">
                            <div>Region</div>
                            <div class="grant-detail-value">${grant.regions.join(', ')}</div>
                        </div>
                    </div>
                    <div class="grant-eligibility">
                        <div class="grant-eligibility-title">Eligibility:</div>
                        <ul>${grant.eligibility.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                    <a href="${grant.link}" class="grant-apply" target="_blank">Learn More & Apply ‚Üí</a>
                    <a href="grant-questionnaire.html" class="grant-apply" style="background: linear-gradient(135deg, #10b981, #059669);">Get Help Applying (¬£299)</a>
                `;
                container.appendChild(card);
            });
        }

        function resetSearch() {
            Object.keys(formData).forEach(key => formData[key] = key === 'lookingFor' ? [] : '');
            document.getElementById('postcode').value = '';
            document.getElementById('sector').value = '';
            document.getElementById('yearsInBusiness').value = '';
            document.getElementById('businessSize').value = '';
            document.getElementById('turnover').value = '';
            purposeContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('results').classList.add('hidden');
            showStep(1);
        }
    </script>
</body>
</html>
